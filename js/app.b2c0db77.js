(function(e){function t(t){for(var s,c,o=t[0],i=t[1],u=t[2],d=0,h=[];d<o.length;d++)c=o[d],Object.prototype.hasOwnProperty.call(n,c)&&n[c]&&h.push(n[c][0]),n[c]=0;for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s]);l&&l(t);while(h.length)h.shift()();return r.push.apply(r,u||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],s=!0,o=1;o<a.length;o++){var i=a[o];0!==n[i]&&(s=!1)}s&&(r.splice(t--,1),e=c(c.s=a[0]))}return e}var s={},n={app:0},r=[];function c(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,c),a.l=!0,a.exports}c.m=e,c.c=s,c.d=function(e,t,a){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(c.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)c.d(a,s,function(t){return e[t]}.bind(null,s));return a},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],i=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=i;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var s=a("2b0e"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},r=[],c={name:"App",mounted:function(){var e=this.$store.getters.user;e.id||"/auth/login"===this.$router.currentRoute||this.$router.push("/auth/login")}},o=c,i=(a("5c0b"),a("2877")),u=Object(i["a"])(o,n,r,!1,null,null,null),l=u.exports,d=(a("99af"),a("2f62")),h=a("ec26");s["a"].use(d["a"]);var p=new d["a"].Store({state:{story:{id:Object(h["a"])(),scenes:[],characters:[],plan:[]},user:{name:"",id:""},stories:[],assetPacks:[]},getters:{story:function(e){return window.console.log("getting story in store"),window.console.log("story is"),window.console.log(e.story),e.story},stories:function(e){return e.stories},user:function(e){return e.user}},mutations:{update:function(e,t){window.console.log("updating story in store"),e.story=t},openNew:function(e){e.story={id:Object(h["a"])(),title:"",scenes:[],characters:[],plan:[]}},close:function(e){e.story={}},save:function(e,t){this.state.story=t},importAssetsToStory:function(e,t){t.scenes&&(e.story.scenes=e.story.scenes.concat(t.scenes)),t.characters&&(e.story.characters=e.story.characters.concat(t.characters))},auth:function(e,t){e.user=t}}}),f=a("8c4f"),v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page menu"},[a("h1",[e._v("Story Maker")]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:e.newStory}},[e._v("New Story")]),a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/assets")}}},[e._v("Assets")])]),a("h2",[e._v("Stories")]),e._l(e.stories,(function(t){return a("button",{key:t.id,staticClass:"wideMenu button",on:{click:function(a){return e.loadStory(t)}}},[e._v(" Load "+e._s(t.title)+" ")])}))],2)},m=[],b=(a("96cf"),a("1da1")),g=(a("caad"),a("c975"),a("a434"),a("2532"),a("b85c")),w=(a("4160"),a("b0c0"),a("159b"),a("8aa5")),k=a.n(w),y={db:function(){return k.a.firestore()},saveWithDb:function(e,t,a,s){window.console.log("Firebase # save [collection: '".concat(t,"' id: '").concat(a,"']")),e.collection(t).doc(a).set(s)},save:function(e,t,a){this.saveWithDb(this.db(),e,t,a)},loadWithDb:function(e,t,a){return Object(b["a"])(regeneratorRuntime.mark((function s(){var n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(!t||!a){s.next=6;break}return window.console.log("Firebase # load [collection: '".concat(t,"' id: '").concat(a,"']")),n={},s.next=5,e.collection(t).doc(a).get().then((function(e){return n=e.exists?e.data():{}})).catch((function(e){return window.console.log("Error",e)}));case 5:return s.abrupt("return",n);case 6:case"end":return s.stop()}}),s)})))()},load:function(e,t){var a=this;return Object(b["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,a.loadWithDb(a.db(),e,t);case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}}),s)})))()},loadAllWithDb:function(e,t){return Object(b["a"])(regeneratorRuntime.mark((function a(){var s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return window.console.log("Firebase # load all [collection: ".concat(t,"]")),s=[],a.next=4,e.collection(t).get().then((function(e){return e.forEach((function(e){return s.push(e.data())}))})).catch((function(e){return window.console.log("Error",e)}));case 4:return a.abrupt("return",s);case 5:case"end":return a.stop()}}),a)})))()},loadAll:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.loadAllWithDb(t.db(),e);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()},search:function(e,t){var a=this;return Object(b["a"])(regeneratorRuntime.mark((function s(){var n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return n=[],s.next=3,a.db().collection(e).where(t.field,"==",t.value).get().then((function(e){return e.forEach((function(e){return n.push(e.data())}))})).catch((function(e){return window.console.log("Error",e)}));case 3:if(!(n.length>0)){s.next=7;break}return s.abrupt("return",n[0]);case 7:return s.abrupt("return",!1);case 8:case"end":return s.stop()}}),s)})))()},saveAssetPack:function(e){window.console.log("Firebase # saveAssetPack"),window.console.log(e);var t,a=k.a.firestore(),s=JSON.parse(JSON.stringify(e)),n=Object(g["a"])(s.scenes);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.saveImage(a,r),s.scenes.splice(s.scenes.indexOf(r),1,r.id)}}catch(u){n.e(u)}finally{n.f()}var c,o=Object(g["a"])(s.characters);try{for(o.s();!(c=o.n()).done;){var i=c.value;this.saveImage(a,i),s.characters.splice(s.characters.indexOf(i),1,i.id)}}catch(u){o.e(u)}finally{o.f()}this.saveWithDb(a,"assetPacks",e.id,s),this.saveWithDb(a,"assetPackKeys",e.id,{id:e.id,name:e.name})},loadAssetPack:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function a(){var s,n,r,c,o,i,u,l,d,h;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return window.console.log("Firebase # loadAssetPack("+e+")"),s=k.a.firestore(),a.next=4,t.loadWithDb(s,"assetPacks",e);case 4:n=a.sent,r=Object(g["a"])(n.characters),a.prev=6,r.s();case 8:if((c=r.n()).done){a.next=16;break}return o=c.value,a.next=12,t.loadImage(s,o);case 12:i=a.sent,n.characters.splice(n.characters.indexOf(o),1,i);case 14:a.next=8;break;case 16:a.next=21;break;case 18:a.prev=18,a.t0=a["catch"](6),r.e(a.t0);case 21:return a.prev=21,r.f(),a.finish(21);case 24:u=Object(g["a"])(n.scenes),a.prev=25,u.s();case 27:if((l=u.n()).done){a.next=35;break}return d=l.value,a.next=31,t.loadImage(s,d);case 31:h=a.sent,n.scenes.splice(n.scenes.indexOf(d),1,h);case 33:a.next=27;break;case 35:a.next=40;break;case 37:a.prev=37,a.t1=a["catch"](25),u.e(a.t1);case 40:return a.prev=40,u.f(),a.finish(40);case 43:return a.abrupt("return",n);case 44:case"end":return a.stop()}}),a,null,[[6,18,21,24],[25,37,40,43]])})))()},getAssetPackList:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return window.console.log("Firebase # getAssetPackList"),t.next=3,e.loadAll("assetPackKeys");case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},saveImage:function(e,t){window.console.log("Firebase # saveImage"),window.console.log(t),this.saveWithDb(e,"images",t.id,t)},loadImage:function(e,t){var a=this;return Object(b["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,a.loadWithDb(e,"images",t);case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}}),s)})))()},saveStory:function(e){window.console.log("Firebase # saveStory");var t,a=k.a.firestore(),s=JSON.parse(JSON.stringify(e)),n=Object(g["a"])(s.scenes);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.saveImage(a,r),s.scenes.splice(s.scenes.indexOf(r),1,r.id)}}catch(u){n.e(u)}finally{n.f()}var c,o=Object(g["a"])(s.characters);try{for(o.s();!(c=o.n()).done;){var i=c.value;this.saveImage(a,i),s.characters.splice(s.characters.indexOf(i),1,i.id)}}catch(u){o.e(u)}finally{o.f()}this.saveWithDb(a,"story",e.id,s),this.saveWithDb(a,"stories",e.id,{id:e.id,title:e.title})},loadStories:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return window.console.log("Firebase # loadStories"),t.next=3,e.loadAll("stories");case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},loadStory:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function a(){var s,n,r,c,o,i,u,l,d,h;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return window.console.log("Firebase # loadStory"),s=t.db(),a.next=4,t.loadWithDb(s,"story",e);case 4:n=a.sent,r=Object(g["a"])(n.characters),a.prev=6,r.s();case 8:if((c=r.n()).done){a.next=16;break}return o=c.value,a.next=12,t.loadImage(s,o);case 12:i=a.sent,n.characters.splice(n.characters.indexOf(o),1,i);case 14:a.next=8;break;case 16:a.next=21;break;case 18:a.prev=18,a.t0=a["catch"](6),r.e(a.t0);case 21:return a.prev=21,r.f(),a.finish(21);case 24:u=Object(g["a"])(n.scenes),a.prev=25,u.s();case 27:if((l=u.n()).done){a.next=35;break}return d=l.value,a.next=31,t.loadImage(s,d);case 31:h=a.sent,n.scenes.splice(n.scenes.indexOf(d),1,h);case 33:a.next=27;break;case 35:a.next=40;break;case 37:a.prev=37,a.t1=a["catch"](25),u.e(a.t1);case 40:return a.prev=40,u.f(),a.finish(40);case 43:return a.abrupt("return",n);case 44:case"end":return a.stop()}}),a,null,[[6,18,21,24],[25,37,40,43]])})))()}},x={},_=function(){var e=Object(b["a"])(regeneratorRuntime.mark((function e(t,a){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!x[t]){e.next=4;break}return e.abrupt("return",x[t]);case 4:return e.next=6,a();case 6:return s=e.sent,x[t]=s,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),C={getImageWithDb:function(e,t){return Object(b["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,_(t,(function(){return y.loadImage(e,t)}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()},getImage:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,_(e,(function(){return t.load("images",e)}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()}},O={save:function(e){p.commit("save",e);var t,a=y.db(),s=JSON.parse(JSON.stringify(e)),n=Object(g["a"])(s.scenes);try{for(n.s();!(t=n.n()).done;){var r=t.value;y.saveImage(a,r),s.scenes.splice(s.scenes.indexOf(r),1,r.id)}}catch(u){n.e(u)}finally{n.f()}var c,o=Object(g["a"])(s.characters);try{for(o.s();!(c=o.n()).done;){var i=c.value;y.saveImage(a,i),s.characters.splice(s.characters.indexOf(i),1,i.id)}}catch(u){o.e(u)}finally{o.f()}y.saveWithDb(a,"story",e.id,s),this.saveUsersStories(a,e),this.updatePublicStories(a,e.id,e.public)},saveUsersStories:function(e,t){return Object(b["a"])(regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return window.console.log("saveUsersStories"),s=p.getters.user,a.next=4,y.loadWithDb(e,"users-stories",s.id);case 4:n=a.sent,n.stories||(n.stories=[]),n.stories.includes(t.id)||n.stories.push(t.id),y.saveWithDb(e,"users-stories",s.id,n);case 8:case"end":return a.stop()}}),a)})))()},updatePublicStories:function(e,t,a){return Object(b["a"])(regeneratorRuntime.mark((function s(){var n,r;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,y.loadWithDb(e,"public","public");case 2:return n=s.sent,r=n.stories.includes(t),a&&!r?n.stories.push(t):!a&&r&&n.stories.splice(n.stories.indexOf(t),1),s.next=7,y.saveWithDb(e,"public","public",n);case 7:case"end":return s.stop()}}),s)})))()},loadPublicStory:function(e){return Object(b["a"])(regeneratorRuntime.mark((function t(){var a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return window.console.log("getting story for id "+e),a=y.db(),t.next=4,y.loadWithDb(a,"public","public");case 4:if(s=t.sent,!s.stories.includes(e)){t.next=10;break}return window.console.log("found in public"),t.next=9,y.loadWithDb(a,"story",e);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t)})))()},loadStories:function(){return Object(b["a"])(regeneratorRuntime.mark((function e(){var t,a,s,n,r,c,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(window.console.log("loadStories"),t=p.getters.user,!t){e.next=28;break}return e.next=5,y.load("users-stories",t.id);case 5:if(a=e.sent,s=[],!a||!a.stories){e.next=27;break}n=Object(g["a"])(a.stories),e.prev=9,n.s();case 11:if((r=n.n()).done){e.next=19;break}return c=r.value,e.next=15,y.load("story",c);case 15:o=e.sent,s.push(o);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e["catch"](9),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:return e.abrupt("return",s);case 28:return e.abrupt("return",[]);case 29:case"end":return e.stop()}}),e,null,[[9,21,24,27]])})))()},loadStory:function(e){return Object(b["a"])(regeneratorRuntime.mark((function t(){var a,s,n,r,c,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:window.console.log("loadStory"),a=y.db(),s=Object(g["a"])(e.characters),t.prev=3,s.s();case 5:if((n=s.n()).done){t.next=15;break}return r=n.value,t.t0=e.characters,t.t1=e.characters.indexOf(r),t.next=11,C.getImageWithDb(a,r);case 11:t.t2=t.sent,t.t0.splice.call(t.t0,t.t1,1,t.t2);case 13:t.next=5;break;case 15:t.next=20;break;case 17:t.prev=17,t.t3=t["catch"](3),s.e(t.t3);case 20:return t.prev=20,s.f(),t.finish(20);case 23:c=Object(g["a"])(e.scenes),t.prev=24,c.s();case 26:if((o=c.n()).done){t.next=36;break}return i=o.value,t.t4=e.scenes,t.t5=e.scenes.indexOf(i),t.next=32,C.getImageWithDb(a,i);case 32:t.t6=t.sent,t.t4.splice.call(t.t4,t.t5,1,t.t6);case 34:t.next=26;break;case 36:t.next=41;break;case 38:t.prev=38,t.t7=t["catch"](24),c.e(t.t7);case 41:return t.prev=41,c.f(),t.finish(41);case 44:return t.abrupt("return",e);case 45:case"end":return t.stop()}}),t,null,[[3,17,20,23],[24,38,41,44]])})))()}},S={data:function(){return{stories:[]}},mounted:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,O.loadStories();case 2:e.stories=t.sent;case 3:case"end":return t.stop()}}),t)})))()},methods:{newStory:function(){this.$store.commit("openNew"),this.$router.push("/edit")},loadStory:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,O.loadStory(e);case 2:e=a.sent,t.$store.commit("save",e),t.$router.push("/menu");case 5:case"end":return a.stop()}}),a)})))()}}},P=S,j=Object(i["a"])(P,v,m,!1,null,null,null),$=j.exports,R=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("h1",[e._v(e._s(e.story.title?e.story.title:"New Story"))]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/edit")}}},[e._v("Edit")]),a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/assets")}}},[e._v("Assets")]),a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/play")}}},[e._v("Play")])]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:e.close}},[e._v("Close")])])])},A=[],D=(a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),{data:function(){return{importedStory:{}}},computed:{story:function(){return window.console.log("getting story"),this.$store.getters.story}},methods:{close:function(){this.$store.commit("close"),this.$router.push("/")},download:function(e,t,a){var s=new Blob([e],{type:a});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(s,t);else{var n=document.createElement("a"),r=URL.createObjectURL(s);n.href=r,n.download=t,document.body.appendChild(n),n.click(),setTimeout((function(){document.body.removeChild(n),window.URL.revokeObjectURL(r)}),0)}}}}),I=D,N=Object(i["a"])(I,R,A,!1,null,null,null),T=N.exports,W=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("h1",[e._v("Story Maker - Editor")]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:e.save}},[e._v("Save")]),a("button",{staticClass:"button",on:{click:e.play}},[e._v("Play")]),a("button",{staticClass:"button",on:{click:e.back}},[e._v("Back")])]),a("span",{staticClass:"field"},[a("label",[e._v("Story title")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.story.title,expression:"story.title"}],attrs:{type:"text"},domProps:{value:e.story.title},on:{input:function(t){t.target.composing||e.$set(e.story,"title",t.target.value)}}})]),a("span",{staticClass:"field"},[a("label",[e._v("Public:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.story.public,expression:"story.public"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.story.public)?e._i(e.story.public,null)>-1:e.story.public},on:{change:function(t){var a=e.story.public,s=t.target,n=!!s.checked;if(Array.isArray(a)){var r=null,c=e._i(a,r);s.checked?c<0&&e.$set(e.story,"public",a.concat([r])):c>-1&&e.$set(e.story,"public",a.slice(0,c).concat(a.slice(c+1)))}else e.$set(e.story,"public",n)}}})]),e.story.public?a("span",{staticClass:"field"},[a("label",[e._v("Url:")]),a("a",{attrs:{href:e.publicUrl}},[e._v(e._s(e.publicUrl))])]):e._e(),a("h2",[e._v("Scenes")]),a("p",[e._v(e._s(e.story.scenes?e.story.scenes.length:0)+" scenes")]),a("ul",e._l(e.story.scenes,(function(t,s){return a("li",{key:s},[e._v(e._s(t.name))])})),0),a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/edit/scenes")}}},[e._v("Edit Scenes")]),a("h2",[e._v("Characters")]),a("p",[e._v(e._s(e.story.characters?e.story.characters.length:0)+" characters")]),a("ul",e._l(e.story.characters,(function(t,s){return a("li",{key:s},[e._v(e._s(t.name))])})),0),a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/edit/characters")}}},[e._v("Edit Characters")]),a("h2",[e._v("Plan")]),a("p",[e._v(e._s(e.story.plan?e.story.plan.length:0)+" steps in plan")]),a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/edit/plan")}}},[e._v("Edit Plan")])])},E=[],M={name:"Editor",data:function(){return{uploadStory:"",story:{}}},mounted:function(){this.story=this.$store.getters.story},methods:{play:function(){O.save(this.story),this.$router.push("/play")},back:function(){O.save(this.story),this.$router.push("/menu")},save:function(){O.save(this.story)}},computed:{publicUrl:function(){return"https://metalcarratt.github.io/storymaker-public/#/public/"+this.story.id}}},U=M,F=Object(i["a"])(U,W,E,!1,null,null,null),L=F.exports,B=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("h2",[e._v("Scenes")]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:e.addScene}},[e._v("New Scene")]),a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/edit")}}},[e._v("Back")])]),a("ul",{staticClass:"editlist box"},e._l(e.scenes,(function(t){return a("li",{key:t.id},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"scene.name"}],attrs:{type:"text",placeholder:"Name"},domProps:{value:t.name},on:{input:function(a){a.target.composing||e.$set(t,"name",a.target.value)}}}),a("img",{attrs:{src:t.image}}),a("span",{staticClass:"buttons"},[a("UploadFile",{attrs:{id:"uploadScene"+t.id},model:{value:t.image,callback:function(a){e.$set(t,"image",a)},expression:"scene.image"}}),a("button",{staticClass:"button danger",on:{click:function(a){return e.deleteScene(t)}}},[e._v("Delete")])],1)])})),0)])},J=[],z=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"upload"},[a("input",{attrs:{id:e.getId,type:"file"},on:{change:function(t){return e.uploadFile(t)}}}),a("label",{class:["button",e.labelClass],attrs:{for:e.getId}},[e._v(e._s(e.label?e.label:"Upload"))])])},K=[],q={props:["value","text","id","label","labelClass"],data:function(){return{reader:new FileReader}},mounted:function(){this.reader.addEventListener("load",this.whenFileLoaded,!1)},computed:{getId:function(){return this.id?this.id:"file"}},methods:{uploadFile:function(e){window.console.log("upload file clicked");var t=e.target.files[0];this.text?(window.console.log("it's text"),this.reader.readAsText(t)):this.reader.readAsDataURL(t)},whenFileLoaded:function(){window.console.log("file loaded"),this.$emit("input",this.reader.result)}}},H=q,Q=Object(i["a"])(H,z,K,!1,null,null,null),V=Q.exports,Y={components:{UploadFile:V},data:function(){return{scenes:[],checkedScenes:[]}},mounted:function(){this.scenes=this.$store.getters.story.scenes},methods:{addScene:function(){this.scenes.push({id:Object(h["a"])(),name:"",image:""})},deleteScene:function(e){this.scenes.splice(this.scenes.indexOf(e),1)}}},G=Y,X=(a("66dc"),Object(i["a"])(G,B,J,!1,null,"37e6d2f1",null)),Z=X.exports,ee=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("h2",[e._v("Characters")]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:e.addCharacter}},[e._v("New Character")]),a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/edit")}}},[e._v("Back")])]),a("ul",{staticClass:"editlist box"},e._l(e.characters,(function(t){return a("li",{key:t.id},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"character.name"}],attrs:{type:"text",placeholder:"Name"},domProps:{value:t.name},on:{input:function(a){a.target.composing||e.$set(t,"name",a.target.value)}}}),a("img",{attrs:{src:t.image}}),a("span",{staticClass:"field"},[a("label",[e._v("Speech Box Colour")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.colour,expression:"character.colour"}],attrs:{type:"color"},domProps:{value:t.colour},on:{input:function(a){a.target.composing||e.$set(t,"colour",a.target.value)}}})]),a("span",{staticClass:"field"},[a("label",[e._v("Y-Offset")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.yoffset,expression:"character.yoffset"}],attrs:{type:"number"},domProps:{value:t.yoffset},on:{input:function(a){a.target.composing||e.$set(t,"yoffset",a.target.value)}}})]),a("span",{staticClass:"field"},[a("label",[e._v("Scale")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.scale,expression:"character.scale"}],attrs:{type:"number"},domProps:{value:t.scale},on:{input:function(a){a.target.composing||e.$set(t,"scale",a.target.value)}}})]),a("Canvas",{attrs:{id:"canvas"+t.id,width:304,height:190,character:t,text:"Hi"}}),a("span",{staticClass:"buttons"},[a("UploadFile",{attrs:{id:"uploadCharacter"+t.id},model:{value:t.image,callback:function(a){e.$set(t,"image",a)},expression:"character.image"}}),a("button",{staticClass:"button danger",on:{click:function(a){return e.deleteCharacter(t)}}},[e._v("Delete")])],1)],1)})),0)])},te=[],ae=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("canvas",{attrs:{id:e.id,width:e.width,height:e.height},on:{click:function(t){return e.$emit("nextStep")}}})},se=[],ne=a("1157"),re=a.n(ne),ce=a("acea"),oe=a.n(ce);oe()(re.a,window);var ie={props:["id","width","height","scene","character","text","align"],data:function(){return{characterImageMeta:{width:0,height:0}}},mounted:function(){window.console.log(""),window.console.log(this.id+" mounted"),this.loadMetadata(),this.draw()},watch:{scene:{handler:function(){window.console.log(""),window.console.log(this.id+" scene updated"),this.draw()},deep:!0},character:{handler:function(){window.console.log(""),window.console.log(this.id+" character updated"),this.loadMetadata()},deep:!0},characterImageMeta:{handler:function(){window.console.log(""),window.console.log(this.id+" image meta updated"),this.draw()},deep:!0},text:function(){window.console.log(""),window.console.log(this.id+" text updated"),this.draw()}},computed:{xscale:function(){return this.width/800},yscale:function(){return this.height/500}},methods:{draw:function(){window.console.log(this.id+" draw ******"),window.console.log("scene? "+(!1!==this.scene)),window.console.log("character? "+(!1!==this.character));var e=this.id?re()("#"+this.id):re()("canvas");e.clearCanvas(),this.drawBorder(e),this.drawScene(e),this.drawCharacter(e),this.drawText(e)},drawBorder:function(e){e.drawRect({strokeStyle:"#c33",strokeWidth:1,x:1,y:1,width:this.width-2,height:this.height-2,fromCenter:!1})},drawScene:function(e){this.scene&&this.scene.image&&e.drawImage({source:this.scene.image,x:2,y:2,width:this.width-4,height:this.height-4,scale:1,fromCenter:!1})},drawCharacter:function(e){if(this.character&&this.character.image){var t=200*this.yscale+(this.character.yoffset?5*parseInt(this.character.yoffset):0),a=this.character.scale?parseFloat(this.character.scale):1;window.console.log("width: "+this.characterImageMeta.width*this.xscale),window.console.log("height: "+this.characterImageMeta.height*this.yscale);var s=0;s="Right"===this.align?(780-this.characterImageMeta.width)*this.xscale:"Center"===this.align?(400-this.characterImageMeta.width/2)*this.xscale:10*this.xscale,e.drawImage({source:this.character.image,x:s,y:t,width:this.characterImageMeta.width*this.xscale*a,height:this.characterImageMeta.height*this.yscale*a,fromCenter:!1})}},drawText:function(e){var t=this.character.colour?this.character.colour:"#69A0D7",a="#2D4258",s="#ECF3FA";e.drawRect({fillStyle:t,x:20*this.xscale,y:20*this.yscale,width:770*this.xscale,height:80*this.yscale,fromCenter:!1,cornerRadius:4}),e.drawRect({strokeStyle:a,x:24*this.xscale,y:24*this.yscale,width:762*this.xscale,height:72*this.yscale,fromCenter:!1,cornerRadius:2}),e.drawText({name:"drawText",fillStyle:s,strokeWidth:1,x:34*this.xscale,y:34*this.yscale,fontSize:18*this.xscale+"pt",fromCenter:!1,text:'"'+this.text+'"'}),e.drawText({name:"drawText",fillStyle:s,strokeWidth:1,x:45*this.xscale,y:74*this.yscale,fontSize:18*this.xscale+"pt",text:"..."})},loadMetadata:function(){var e=this,t=new Image;t.onload=function(){window.console.log("loaded metadata"),e.characterImageMeta.width=t.width,e.characterImageMeta.height=t.height,e.draw()},t.src=this.character.image}}},ue=ie,le=Object(i["a"])(ue,ae,se,!1,null,null,null),de=le.exports,he={components:{UploadFile:V,Canvas:de},data:function(){return{characters:[]}},mounted:function(){this.characters=this.$store.getters.story.characters},methods:{addCharacter:function(){this.characters.push({id:Object(h["a"])(),name:"",image:"",colour:"#69A0D7",yoffset:0,scale:1})},deleteCharacter:function(e){this.characters.splice(this.characters.indexOf(e),1)}}},pe=he,fe=(a("83d7"),Object(i["a"])(pe,ee,te,!1,null,"7ad5c17b",null)),ve=fe.exports,me=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("h2",[e._v("Plan")]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:e.newItem}},[e._v("New")]),a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/edit")}}},[e._v("Back")])]),a("ul",{staticClass:"editlist"},e._l(e.plan,(function(t,s){return a("li",{key:s},[a("span",{staticClass:"number"},[e._v(e._s(s+1))]),a("span",{staticClass:"content"},[void 0!==t.scene?a("span",{staticClass:"field"},[a("label",[e._v("Scene: ")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.scene,expression:"item.scene"}],on:{change:function(a){var s=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(t,"scene",a.target.multiple?s:s[0])}}},e._l(e.scenes,(function(t,s){return a("option",{key:s},[e._v(e._s(t.name))])})),0)]):a("button",{staticClass:"button small",on:{click:function(a){return e.changeScene(t)}}},[e._v("Change scene")]),void 0!==t.character?a("span",{staticClass:"field"},[a("label",[e._v("Character: ")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.character,expression:"item.character"}],on:{change:function(a){var s=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(t,"character",a.target.multiple?s:s[0])}}},e._l(e.characters,(function(t,s){return a("option",{key:s},[e._v(e._s(t.name))])})),0)]):a("button",{staticClass:"button small",on:{click:function(a){return e.changeCharacter(t)}}},[e._v("Change character")]),a("span",{staticClass:"field"},[a("label",[e._v("Align: ")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.align,expression:"item.align"}],on:{change:function(a){var s=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(t,"align",a.target.multiple?s:s[0])}}},[a("option",[e._v("Left")]),a("option",[e._v("Center")]),a("option",[e._v("Right")])])]),a("span",{staticClass:"field"},[a("label",[e._v("Message: ")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"item.text"}],domProps:{value:t.text},on:{input:function(a){a.target.composing||e.$set(t,"text",a.target.value)}}})])]),a("Canvas",{staticClass:"sidebyside",attrs:{id:"canvas"+s,width:304,height:190,character:e.getCharacter(t.character),text:t.text,scene:e.getScene(t.scene),align:t.align}})],1)})),0),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:e.newItem}},[e._v("New")]),a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/edit")}}},[e._v("Back")])])])},be=[],ge=(a("7db0"),{components:{Canvas:de},data:function(){return{plan:[],scenes:[],characters:[]}},mounted:function(){this.plan=this.$store.getters.story.plan,this.scenes=this.$store.getters.story.scenes,this.characters=this.$store.getters.story.characters},methods:{newItem:function(){this.plan.push({scene:void 0,character:void 0,text:"",align:"Left"})},changeScene:function(e){e.scene=""},changeCharacter:function(e){e.character=""},getCharacter:function(e){return this.characters.find((function(t){return t.name===e}))},getScene:function(e){if(e)return this.scenes.find((function(t){return t.name===e}))}}}),we=ge,ke=Object(i["a"])(we,me,be,!1,null,null,null),ye=ke.exports,xe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("h1",[e._v("Download Story from Cloud")]),a("div",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/")}}},[e._v("Back")])]),e._l(e.stories,(function(t){return a("button",{key:t.id,staticClass:"wideMenu button",on:{click:function(a){return e.downloadStory(t.id)}}},[e._v(e._s(t.title))])}))],2)},_e=[],Ce={data:function(){return{stories:[]}},mounted:function(){this.stories=y.loadStories()},methods:{downloadStory:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function a(){var s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,y.loadStory(e);case 2:s=a.sent,t.$store.commit("save",s),t.$store.commit("load",s.id),t.$router.push("/menu");case 6:case"end":return a.stop()}}),a)})))()}}},Oe=Ce,Se=Object(i["a"])(Oe,xe,_e,!1,null,null,null),Pe=Se.exports,je=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("h1",[e._v(e._s(e.story.title))]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:function(t){return e.$router.push("/menu")}}},[e._v("Stop")])]),a("Canvas",{attrs:{id:"canvas1",width:800,height:500,scene:this.scene,character:this.character,text:e.text,align:e.align},on:{nextStep:e.nextStep}})],1)},$e=[];oe()(re.a,window);var Re={name:"Play",components:{Canvas:de},data:function(){return{story:{},scene:{},character:{},characterImageMeta:{width:0,height:0},text:"",index:0,align:"Left"}},mounted:function(){this.story=this.$store.getters.story,this.index=0,this.update()},methods:{update:function(){var e=this.story.plan[this.index];e.scene&&(this.scene=this.story.scenes.find((function(t){return t.name===e.scene}))),e.character&&(this.character=this.story.characters.find((function(t){return t.name===e.character}))),e.text&&(this.text=e.text),this.align=e.align,this.loadMetadataAndDraw()},nextStep:function(){this.index++,this.index>=this.story.plan.length?this.$router.push("/"):this.update()},loadMetadataAndDraw:function(){var e=this,t=new Image;t.onload=function(){e.characterImageMeta.width=t.width,e.characterImageMeta.height=t.height},t.src=this.character.image}}},Ae=Re,De=Object(i["a"])(Ae,je,$e,!1,null,null,null),Ie=De.exports,Ne=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page menu"},[a("h2",[e._v("Asset Packs")]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:e.back}},[e._v("Back")]),a("button",{staticClass:"button",attrs:{title:"Download new asset packs from the cloud"},on:{click:e.download}},[e._v("Download")]),a("button",{staticClass:"button",attrs:{title:"Create a new asset pack"},on:{click:e.newPack}},[e._v("New")])]),e._l(e.assetPacks,(function(t){return a("button",{key:t.id,staticClass:"wideMenu button",attrs:{title:"View asset pack "+t.name},on:{click:function(a){return e.viewPack(t)}}},[e._v(e._s(t.name))])}))],2)},Te=[],We={save:function(e){var t,a=p.getters.user,s=y.db(),n=JSON.parse(JSON.stringify(e)),r=Object(g["a"])(n.scenes);try{for(r.s();!(t=r.n()).done;){var c=t.value;y.saveImage(s,c),n.scenes.splice(n.scenes.indexOf(c),1,c.id)}}catch(l){r.e(l)}finally{r.f()}var o,i=Object(g["a"])(n.characters);try{for(i.s();!(o=i.n()).done;){var u=o.value;y.saveImage(s,u),n.characters.splice(n.characters.indexOf(u),1,u.id)}}catch(l){i.e(l)}finally{i.f()}y.saveWithDb(s,"assetPacks",e.id,n),y.saveWithDb(s,"assetPackKeys",e.id,{id:e.id,name:e.name}),this.saveUsersAssetPacks(s,a,e)},saveUsersAssetPacks:function(e,t,a){return Object(b["a"])(regeneratorRuntime.mark((function s(){var n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return window.console.log("saveUsersAssetPacks"),s.next=3,y.loadWithDb(e,"users-assetPacks",t.id);case 3:n=s.sent,window.console.log(n),window.console.log(e+t+a),n.assetPacks||(n.assetPacks=[]),n.assetPacks.includes(a.id)||n.assetPacks.push(a.id),y.saveWithDb(e,"users-assetPacks",t.id,n);case 9:case"end":return s.stop()}}),s)})))()},loadAll:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var a,s,n,r,c,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return window.console.log("loadAssetPacks"),a=y.db(),s=p.getters.user,t.next=5,y.loadWithDb(a,"users-assetPacks",s.id);case 5:if(n=t.sent,!n.assetPacks){t.next=32;break}r=[],c=Object(g["a"])(n.assetPacks),t.prev=9,c.s();case 11:if((o=c.n()).done){t.next=20;break}return i=o.value,t.t0=r,t.next=16,e.loadWithDb(a,i);case 16:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 18:t.next=11;break;case 20:t.next=25;break;case 22:t.prev=22,t.t2=t["catch"](9),c.e(t.t2);case 25:return t.prev=25,c.f(),t.finish(25);case 28:return window.console.log(r),t.abrupt("return",r);case 32:return t.abrupt("return",[]);case 33:case"end":return t.stop()}}),t,null,[[9,22,25,28]])})))()},load:function(e){return Object(b["a"])(regeneratorRuntime.mark((function t(){var a,s,n,r,c,o,i,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return window.console.log("loadAssetPack "+e),a=y.db(),t.next=4,y.loadWithDb(a,"assetPacks",e);case 4:s=t.sent,n=Object(g["a"])(s.characters),t.prev=6,n.s();case 8:if((r=n.n()).done){t.next=18;break}return c=r.value,t.t0=s.characters,t.t1=s.characters.indexOf(c),t.next=14,C.getImageWithDb(a,c);case 14:t.t2=t.sent,t.t0.splice.call(t.t0,t.t1,1,t.t2);case 16:t.next=8;break;case 18:t.next=23;break;case 20:t.prev=20,t.t3=t["catch"](6),n.e(t.t3);case 23:return t.prev=23,n.f(),t.finish(23);case 26:o=Object(g["a"])(s.scenes),t.prev=27,o.s();case 29:if((i=o.n()).done){t.next=39;break}return u=i.value,t.t4=s.scenes,t.t5=s.scenes.indexOf(u),t.next=35,C.getImageWithDb(a,u);case 35:t.t6=t.sent,t.t4.splice.call(t.t4,t.t5,1,t.t6);case 37:t.next=29;break;case 39:t.next=44;break;case 41:t.prev=41,t.t7=t["catch"](27),o.e(t.t7);case 44:return t.prev=44,o.f(),t.finish(44);case 47:return t.abrupt("return",s);case 48:case"end":return t.stop()}}),t,null,[[6,20,23,26],[27,41,44,47]])})))()},loadWithDb:function(e,t){return Object(b["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,y.loadWithDb(e,"assetPacks",t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()}},Ee={data:function(){return{assetPacks:[]}},mounted:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,We.loadAll();case 2:a=t.sent,window.console.log("ap"),window.console.log(a),e.assetPacks=a;case 6:case"end":return t.stop()}}),t)})))()},methods:{back:function(){this.$router.push("/")},newPack:function(){this.$router.push("/assets/update/new")},viewPack:function(e){this.$router.push("/assets/view/"+e.id)},download:function(){this.$router.push("assets/download")}}},Me=Ee,Ue=Object(i["a"])(Me,Ne,Te,!1,null,null,null),Fe=Ue.exports,Le=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("h1",[e._v("Update Assets")]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:e.save}},[e._v("Save")]),a("button",{staticClass:"button",on:{click:e.back}},[e._v("Back")])]),a("h2",[e._v("Asset pack")]),a("span",{staticClass:"field"},[a("label",[e._v("Name")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.assetPack.name,expression:"assetPack.name"}],attrs:{type:"text"},domProps:{value:e.assetPack.name},on:{input:function(t){t.target.composing||e.$set(e.assetPack,"name",t.target.value)}}})]),a("hr"),a("h2",[e._v("Current assets")]),a("button",{staticClass:"button danger",on:{click:e.removeAssets}},[e._v("Remove")]),a("h3",[e._v("Scenes")]),a("ul",e._l(e.assetPack.scenes,(function(t,s){return a("li",{key:s},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedScenesToDelete,expression:"selectedScenesToDelete"}],attrs:{type:"checkbox",id:"scene"+s},domProps:{value:t.name,checked:Array.isArray(e.selectedScenesToDelete)?e._i(e.selectedScenesToDelete,t.name)>-1:e.selectedScenesToDelete},on:{change:function(a){var s=e.selectedScenesToDelete,n=a.target,r=!!n.checked;if(Array.isArray(s)){var c=t.name,o=e._i(s,c);n.checked?o<0&&(e.selectedScenesToDelete=s.concat([c])):o>-1&&(e.selectedScenesToDelete=s.slice(0,o).concat(s.slice(o+1)))}else e.selectedScenesToDelete=r}}}),a("label",{attrs:{for:"scene"+s}},[e._v(e._s(t.name))])])})),0),a("h3",[e._v("Characters")]),a("ul",e._l(e.assetPack.characters,(function(t,s){return a("li",{key:s},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedCharactersToDelete,expression:"selectedCharactersToDelete"}],attrs:{type:"checkbox",id:"character"+s},domProps:{value:t.name,checked:Array.isArray(e.selectedCharactersToDelete)?e._i(e.selectedCharactersToDelete,t.name)>-1:e.selectedCharactersToDelete},on:{change:function(a){var s=e.selectedCharactersToDelete,n=a.target,r=!!n.checked;if(Array.isArray(s)){var c=t.name,o=e._i(s,c);n.checked?o<0&&(e.selectedCharactersToDelete=s.concat([c])):o>-1&&(e.selectedCharactersToDelete=s.slice(0,o).concat(s.slice(o+1)))}else e.selectedCharactersToDelete=r}}}),a("label",{attrs:{for:"character"+s}},[e._v(e._s(t.name))])])})),0),a("hr"),a("h2",[e._v("Add from existing project")]),a("button",{staticClass:"button",on:{click:e.addUpdateAssetPack}},[e._v("Add")]),a("h3",[e._v("Scenes")]),a("ul",e._l(e.story.scenes,(function(t,s){return a("li",{key:s},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedScenes,expression:"selectedScenes"}],attrs:{type:"checkbox",id:"scene"+s},domProps:{value:t.name,checked:Array.isArray(e.selectedScenes)?e._i(e.selectedScenes,t.name)>-1:e.selectedScenes},on:{change:function(a){var s=e.selectedScenes,n=a.target,r=!!n.checked;if(Array.isArray(s)){var c=t.name,o=e._i(s,c);n.checked?o<0&&(e.selectedScenes=s.concat([c])):o>-1&&(e.selectedScenes=s.slice(0,o).concat(s.slice(o+1)))}else e.selectedScenes=r}}}),a("label",{attrs:{for:"scene"+s}},[e._v(e._s(t.name))])])})),0),a("h3",[e._v("Characters")]),a("ul",e._l(e.story.characters,(function(t,s){return a("li",{key:s},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedCharacters,expression:"selectedCharacters"}],attrs:{type:"checkbox",id:"character"+s},domProps:{value:t.name,checked:Array.isArray(e.selectedCharacters)?e._i(e.selectedCharacters,t.name)>-1:e.selectedCharacters},on:{change:function(a){var s=e.selectedCharacters,n=a.target,r=!!n.checked;if(Array.isArray(s)){var c=t.name,o=e._i(s,c);n.checked?o<0&&(e.selectedCharacters=s.concat([c])):o>-1&&(e.selectedCharacters=s.slice(0,o).concat(s.slice(o+1)))}else e.selectedCharacters=r}}}),a("label",{attrs:{for:"character"+s}},[e._v(e._s(t.name))])])})),0)])},Be=[],Je=(a("b64b"),{data:function(){return{assetPack:{id:Object(h["a"])(),scenes:[],characters:[]},story:{},selectedScenesToDelete:[],selectedCharactersToDelete:[],selectedScenes:[],selectedCharacters:[]}},mounted:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.$route.params.assetId,"new"===a){t.next=5;break}return t.next=4,We.load(a);case 4:e.assetPack=t.sent;case 5:e.story=e.$store.getters.story;case 6:case"end":return t.stop()}}),t)})))()},computed:{hasAssetPack:function(){return Object.keys(this.assetPack).length>0}},methods:{createNew:function(){this.assetPack={name:""}},addUpdateAssetPack:function(){var e,t=Object(g["a"])(this.selectedScenes);try{for(t.s();!(e=t.n()).done;){var a=e.value;this.assetPack.scenes.push(this.story.scenes.find((function(e){return e.name===a})))}}catch(c){t.e(c)}finally{t.f()}var s,n=Object(g["a"])(this.selectedCharacters);try{for(n.s();!(s=n.n()).done;){var r=s.value;this.assetPack.characters.push(this.story.characters.find((function(e){return e.name===r})))}}catch(c){n.e(c)}finally{n.f()}},save:function(){We.save(this.assetPack),this.$router.push("/assets/view/"+this.assetPack.id)},removeAssets:function(){var e,t=Object(g["a"])(this.selectedScenesToDelete);try{for(t.s();!(e=t.n()).done;){var a=e.value;this.assetPack.scenes.splice(this.assetPack.scenes.indexOf(a),1)}}catch(c){t.e(c)}finally{t.f()}var s,n=Object(g["a"])(this.selectedCharactersToDelete);try{for(n.s();!(s=n.n()).done;){var r=s.value;this.assetPack.characters.splice(this.assetPack.characters.indexOf(r),1)}}catch(c){n.e(c)}finally{n.f()}},back:function(){this.$router.push("/assets/view/"+this.assetPack.id)}}}),ze=Je,Ke=Object(i["a"])(ze,Le,Be,!1,null,null,null),qe=Ke.exports,He=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("h1",[e._v(e._s(e.assetPack.name))]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",attrs:{title:"Edit this asset pack"},on:{click:e.edit}},[e._v("Edit")]),a("button",{staticClass:"button",on:{click:e.back}},[e._v("Back")])]),a("h3",[e._v("Scenes")]),a("ul",e._l(e.assetPack.scenes,(function(t,s){return a("li",{key:s},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedScenes,expression:"selectedScenes"}],attrs:{type:"checkbox",id:"scene"+s},domProps:{value:t.name,checked:Array.isArray(e.selectedScenes)?e._i(e.selectedScenes,t.name)>-1:e.selectedScenes},on:{change:function(a){var s=e.selectedScenes,n=a.target,r=!!n.checked;if(Array.isArray(s)){var c=t.name,o=e._i(s,c);n.checked?o<0&&(e.selectedScenes=s.concat([c])):o>-1&&(e.selectedScenes=s.slice(0,o).concat(s.slice(o+1)))}else e.selectedScenes=r}}}),a("label",{attrs:{for:"scene"+s}},[e._v(e._s(t.name))])])})),0),a("h3",[e._v("Characters")]),a("ul",e._l(e.assetPack.characters,(function(t,s){return a("li",{key:s},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedCharacters,expression:"selectedCharacters"}],attrs:{type:"checkbox",id:"character"+s},domProps:{value:t.name,checked:Array.isArray(e.selectedCharacters)?e._i(e.selectedCharacters,t.name)>-1:e.selectedCharacters},on:{change:function(a){var s=e.selectedCharacters,n=a.target,r=!!n.checked;if(Array.isArray(s)){var c=t.name,o=e._i(s,c);n.checked?o<0&&(e.selectedCharacters=s.concat([c])):o>-1&&(e.selectedCharacters=s.slice(0,o).concat(s.slice(o+1)))}else e.selectedCharacters=r}}}),a("label",{attrs:{for:"character"+s}},[e._v(e._s(t.name))])])})),0),e.selectedScenes.length>0||e.selectedCharacters.length>0?a("span",{staticClass:"buttons"},[a("button",{staticClass:"button wideMenu",attrs:{title:"Imports selected assets into current project"},on:{click:e.importToProject}},[e._v("Import to Project")])]):e._e()])},Qe=[],Ve={data:function(){return{assetPack:{},selectedScenes:[],selectedCharacters:[]}},mounted:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$route.params.assetId,t.next=3,We.load(a);case 3:e.assetPack=t.sent;case 4:case"end":return t.stop()}}),t)})))()},methods:{importToProject:function(){var e,t={scenes:[],characters:[]},a=Object(g["a"])(this.selectedScenes);try{for(a.s();!(e=a.n()).done;){var s=e.value;t.scenes.push(this.assetPack.scenes.find((function(e){return e.name===s})))}}catch(o){a.e(o)}finally{a.f()}var n,r=Object(g["a"])(this.selectedCharacters);try{for(r.s();!(n=r.n()).done;){var c=n.value;t.characters.push(this.assetPack.characters.find((function(e){return e.name===c})))}}catch(o){r.e(o)}finally{r.f()}window.console.log("updating"),window.console.log(t),this.$store.commit("importAssetsToStory",t),this.$router.push("/edit")},edit:function(){this.$router.push("/assets/update/"+this.assetPack.id)},deletePack:function(){this.$router.push("/")},back:function(){this.$router.push("/assets")},clickMe:function(){window.console.log("click me")}}},Ye=Ve,Ge=Object(i["a"])(Ye,He,Qe,!1,null,null,null),Xe=Ge.exports,Ze=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page menu"},[a("h1",[e._v("Download asset packs")]),e._l(e.assetPackList,(function(t){return a("button",{key:t.id,staticClass:"wideMenu button",on:{click:function(a){return e.download(t)}}},[e._v("Download "+e._s(t.name))])}))],2)},et=[],tt={data:function(){return{assetPackList:[]}},mounted:function(){this.assetPackList=y.getAssetPackList()},methods:{download:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function a(){var s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,y.loadAssetPack(e.id);case 2:s=a.sent,window.console.log(s),t.$router.push("/assets/view/"+s.id);case 5:case"end":return a.stop()}}),a)})))()}}},at=tt,st=Object(i["a"])(at,Ze,et,!1,null,null,null),nt=st.exports,rt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page menu"},[a("h1",[e._v("Login")]),a("span",{staticClass:"field"},[a("label",[e._v("Username")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),a("span",{staticClass:"field"},[a("label",[e._v("Password")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),e.errorMessage?a("span",{staticClass:"error"},[e._v(e._s(e.errorMessage))]):e._e(),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:e.createUser}},[e._v("Create User")]),a("button",{staticClass:"button",on:{click:e.login}},[e._v("Login")])])])},ct=[],ot=(a("ac1f"),a("841c"),a("6821")),it=a.n(ot),ut={hash:function(e){return it()(e)},register:function(e,t){var a={id:Object(h["a"])(),username:e,password:this.hash(t)};return y.save("users",a.id,a),a},authenticate:function(e,t){var a=this;return Object(b["a"])(regeneratorRuntime.mark((function s(){var n,r;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,y.search("users",{field:"username",value:e});case 2:return n=s.sent,r=n.password===a.hash(t),window.console.log("Result of auth "+r+", "+n.password+", "+a.hash(t)),r&&p.commit("auth",n),s.abrupt("return",r);case 7:case"end":return s.stop()}}),s)})))()}},lt={data:function(){return{username:"",password:"",errorMessage:""}},methods:{login:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,ut.authenticate(e.username,e.password);case 2:if(!t.sent){t.next=6;break}e.$router.push("/"),t.next=7;break;case 6:e.errorMessage="Invalid";case 7:case"end":return t.stop()}}),t)})))()},createUser:function(){this.$router.push("/auth/create")}}},dt=lt,ht=Object(i["a"])(dt,rt,ct,!1,null,null,null),pt=ht.exports,ft=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page menu"},[a("h1",[e._v("Register")]),a("span",{staticClass:"field"},[a("label",[e._v("Username")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),a("span",{staticClass:"field"},[a("label",[e._v("Password")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),a("span",{staticClass:"buttons"},[a("button",{staticClass:"button",on:{click:e.createUser}},[e._v("Create")])])])},vt=[],mt={data:function(){return{username:"",password:""}},methods:{createUser:function(){var e=ut.register(this.username,this.password);this.$store.commit("auth",e),this.$router.push("/")}}},bt=mt,gt=Object(i["a"])(bt,ft,vt,!1,null,null,null),wt=gt.exports,kt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Play")],1)},yt=[],xt={components:{Play:Ie},mounted:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$route.params.storyId,t.next=3,O.loadPublicStory(a);case 3:return s=t.sent,t.next=6,O.loadStory(s);case 6:s=t.sent,p.commit("save",s);case 8:case"end":return t.stop()}}),t)})))()}},_t=xt,Ct=Object(i["a"])(_t,kt,yt,!1,null,null,null),Ot=Ct.exports,St=[{path:"/",component:$},{path:"/menu",component:T},{path:"/edit",component:L},{path:"/edit/scenes",component:Z},{path:"/edit/characters",component:ve},{path:"/edit/plan",component:ye},{path:"/play",component:Ie},{path:"/assets",component:Fe},{path:"/assets/update/:assetId",component:qe},{path:"/assets/view/:assetId",component:Xe},{path:"/assets/download",component:nt},{path:"/story/download",component:Pe},{path:"/auth/login",component:pt},{path:"/auth/create",component:wt},{path:"/public/:storyId",component:Ot}],Pt=new f["a"]({mode:"hash",routes:St});s["a"].use(f["a"]);var jt=Pt;s["a"].config.productionTip=!1;var $t={apiKey:"AIzaSyDdFELo568ztJgq07FAO8mhRyUq8TKUeyQ",authDomain:"storymaker-3002d.firebaseapp.com",databaseURL:"https://storymaker-3002d.firebaseio.com",projectId:"storymaker-3002d",storageBucket:"storymaker-3002d.appspot.com",messagingSenderId:"846763549713",appId:"1:846763549713:web:581d08961adbee051efdb0"};k.a.initializeApp($t),new s["a"]({store:p,router:jt,render:function(e){return e(l)}}).$mount("#app")},"5c0b":function(e,t,a){"use strict";var s=a("9c0c"),n=a.n(s);n.a},"66dc":function(e,t,a){"use strict";var s=a("dc2a"),n=a.n(s);n.a},"83d7":function(e,t,a){"use strict";var s=a("acb9"),n=a.n(s);n.a},"9c0c":function(e,t,a){},acb9:function(e,t,a){},dc2a:function(e,t,a){}});
//# sourceMappingURL=app.b2c0db77.js.map